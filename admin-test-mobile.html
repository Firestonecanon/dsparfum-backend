<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- AUCUNE CSP DU TOUT - FAVICON DATA URL -->
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==">
    <title>Test Mobile DS Parfum</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); 
            min-height: 100vh; 
            padding: 10px; 
        }
        .container { 
            max-width: 100%;
            margin: 0 auto; 
            background: rgba(255,255,255,0.98); 
            border-radius: 15px; 
            box-shadow: 0 25px 60px rgba(0,0,0,0.15); 
            overflow: hidden; 
        }
        .header { 
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%); 
            color: white; 
            padding: 20px; 
            text-align: center; 
        }
        .header h1 { 
            font-size: 1.8rem; 
            margin-bottom: 10px; 
            font-weight: 800; 
        }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 600; 
            margin: 10px; 
            transition: all 0.3s ease; 
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .btn:hover, .btn:active { transform: translateY(-2px); }
        .loading { 
            text-align: center; 
            padding: 40px 20px; 
            color: #4a5568; 
            font-size: 1rem; 
            background: #f8fafc; 
            border-radius: 12px; 
            margin: 15px; 
        }
        .debug {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin: 15px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Test Admin Mobile</h1>
            <p>Diagnostic interface mobile</p>
        </div>

        <div class="debug" id="debug-info">
            <strong>üîß Debug Info:</strong><br>
            <span id="debug-content">Initialisation...</span>
        </div>

        <div style="padding: 20px;">
            <button class="btn" onclick="testEnvironment()">üîç Test Environnement</button>
            <button class="btn" onclick="testAPI()">üåê Test API</button>
            <button class="btn" onclick="loadClients()">üë• Charger Clients</button>
            <button class="btn" onclick="clearDebug()">üóëÔ∏è Clear</button>
        </div>
        
        <div id="results" class="loading">
            Cliquez sur un bouton pour tester
        </div>
    </div>

    <script>
        let debugInfo = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.push(`[${timestamp}] ${message}`);
            console.log(`üîß [${type.toUpperCase()}] ${message}`);
            updateDebug();
        }
        
        function updateDebug() {
            const debugDiv = document.getElementById('debug-content');
            debugDiv.innerHTML = debugInfo.slice(-10).join('<br>');
        }
        
        function clearDebug() {
            debugInfo = [];
            updateDebug();
            document.getElementById('results').innerHTML = 'Debug vid√©';
        }
        
        function testEnvironment() {
            log('=== TEST ENVIRONNEMENT ===');
            log(`User-Agent: ${navigator.userAgent}`);
            log(`URL actuelle: ${window.location.href}`);
            log(`Mobile d√©tect√©: ${isMobile()}`);
            log(`Android d√©tect√©: ${isAndroid()}`);
            log(`Taille √©cran: ${window.innerWidth}x${window.innerHeight}`);
            log(`API URL: ${getApiBaseUrl()}`);
            
            document.getElementById('results').innerHTML = `
                <div class="debug success">
                    ‚úÖ Test environnement termin√©<br>
                    Mobile: ${isMobile() ? 'OUI' : 'NON'}<br>
                    Android: ${isAndroid() ? 'OUI' : 'NON'}<br>
                    API: ${getApiBaseUrl()}
                </div>
            `;
        }
        
        async function testAPI() {
            log('=== TEST API ===');
            const apiUrl = getApiBaseUrl();
            
            try {
                log(`Tentative connexion vers: ${apiUrl}/api/admin/clients`);
                
                const response = await fetch(`${apiUrl}/api/admin/clients`, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                log(`R√©ponse re√ßue: ${response.status} ${response.statusText}`);
                log(`Headers response: ${JSON.stringify([...response.headers])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`Donn√©es re√ßues: ${JSON.stringify(data).substring(0, 100)}...`);
                    
                    document.getElementById('results').innerHTML = `
                        <div class="debug success">
                            ‚úÖ API accessible !<br>
                            Status: ${response.status}<br>
                            Donn√©es: ${Array.isArray(data) ? data.length + ' clients' : 'Format objet'}
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                log(`ERREUR API: ${error.message}`, 'error');
                
                document.getElementById('results').innerHTML = `
                    <div class="debug error">
                        ‚ùå Erreur API<br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        async function loadClients() {
            log('=== CHARGEMENT CLIENTS ===');
            const apiUrl = getApiBaseUrl();
            
            try {
                const response = await fetch(`${apiUrl}/api/admin/clients`);
                const data = await response.json();
                
                let clientsData = Array.isArray(data) ? data : (data.clients || []);
                log(`Clients charg√©s: ${clientsData.length}`);
                
                let html = `<div class="debug success">‚úÖ ${clientsData.length} clients charg√©s</div>`;
                
                if (clientsData.length > 0) {
                    html += '<div style="margin: 15px; padding: 15px; background: white; border-radius: 8px;">';
                    clientsData.slice(0, 5).forEach(client => {
                        html += `<p><strong>#${client.id}</strong> ${client.name || 'N/A'} - ${client.email}</p>`;
                    });
                    if (clientsData.length > 5) {
                        html += `<p><em>... et ${clientsData.length - 5} autres</em></p>`;
                    }
                    html += '</div>';
                }
                
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                log(`ERREUR CHARGEMENT: ${error.message}`, 'error');
                document.getElementById('results').innerHTML = `
                    <div class="debug error">
                        ‚ùå Erreur chargement<br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        function isAndroid() {
            return /Android/i.test(navigator.userAgent);
        }
        
        function getApiBaseUrl() {
            const hostname = window.location.hostname;
            
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return window.location.origin;
            } else {
                return 'https://api.dsparfum.fr';
            }
        }
        
        // INITIALISATION
        document.addEventListener('DOMContentLoaded', () => {
            log('Interface de test mobile initialis√©e');
            log(`D√©marrage sur: ${window.location.href}`);
        });
    </script>
</body>
</html>
