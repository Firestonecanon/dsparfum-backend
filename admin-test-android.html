<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Test Admin Android - DS Parfum</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px; 
            color: white;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            border-radius: 15px; 
            padding: 20px;
            color: #333;
        }
        .test-result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 8px; 
            font-weight: bold;
        }
        .success { background: #c6f6d5; color: #22543d; }
        .error { background: #fed7d7; color: #742a2a; }
        .info { background: #bee3f8; color: #1a365d; }
        .btn { 
            background: #667eea; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 10px 5px;
            font-size: 16px;
        }
        .btn:active { background: #5a67d8; }
        h1 { color: #1a202c; margin-bottom: 20px; }
        h2 { color: #2d3748; margin: 20px 0 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 Diagnostic Android - Interface Admin</h1>
        
        <h2>📱 Informations Device</h2>
        <div id="device-info"></div>
        
        <h2>🌐 Test Connectivité API</h2>
        <button class="btn" onclick="testAPI()">🔗 Tester API DS Parfum</button>
        <div id="api-results"></div>
        
        <h2>💾 Test Cache</h2>
        <button class="btn" onclick="testCache()">🗑️ Test Cache Android</button>
        <div id="cache-results"></div>
        
        <h2>🎯 Accès Direct Admin</h2>
        <button class="btn" onclick="location.href='admin.html'">👉 Aller à Admin</button>
        <button class="btn" onclick="location.href='https://api.dsparfum.fr/admin.html'">🌍 Admin Direct URL</button>
    </div>

    <script>
        // Diagnostic complet au chargement
        document.addEventListener('DOMContentLoaded', function() {
            diagnoseBrowser();
        });

        function diagnoseBrowser() {
            const deviceInfo = document.getElementById('device-info');
            const userAgent = navigator.userAgent;
            const isAndroid = /Android/i.test(userAgent);
            const isChrome = /Chrome/i.test(userAgent);
            const isMobile = /Mobi|Android/i.test(userAgent);
            
            let html = `
                <div class="test-result ${isAndroid ? 'success' : 'info'}">
                    🤖 Android: ${isAndroid ? 'OUI' : 'NON'}
                </div>
                <div class="test-result ${isChrome ? 'success' : 'info'}">
                    🌐 Chrome: ${isChrome ? 'OUI' : 'NON'}
                </div>
                <div class="test-result ${isMobile ? 'success' : 'info'}">
                    📱 Mobile: ${isMobile ? 'OUI' : 'NON'}
                </div>
                <div class="test-result info">
                    📊 User Agent: ${userAgent}
                </div>
                <div class="test-result info">
                    🔗 URL Actuelle: ${window.location.href}
                </div>
                <div class="test-result info">
                    🕐 Timestamp: ${new Date().toLocaleString('fr-FR')}
                </div>
            `;
            
            deviceInfo.innerHTML = html;
        }

        async function testAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="test-result info">⏳ Test en cours...</div>';
            
            try {
                console.log('🔗 Test API - Début');
                
                // Test 1: Ping API
                const response = await fetch('https://api.dsparfum.fr/api/admin/clients', {
                    method: 'GET',
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    }
                });
                
                console.log('🔗 Response status:', response.status);
                console.log('🔗 Response headers:', response.headers);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('🔗 Data received:', data);
                    
                    resultsDiv.innerHTML = `
                        <div class="test-result success">✅ API OK - Status: ${response.status}</div>
                        <div class="test-result info">📊 Clients trouvés: ${Array.isArray(data) ? data.length : (data.clients ? data.clients.length : 'Format inattendu')}</div>
                        <div class="test-result info">🕐 Test réussi à: ${new Date().toLocaleString('fr-FR')}</div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('❌ Erreur API:', error);
                resultsDiv.innerHTML = `
                    <div class="test-result error">❌ Erreur API: ${error.message}</div>
                    <div class="test-result info">🔍 Vérifiez la connexion réseau</div>
                `;
            }
        }

        function testCache() {
            const resultsDiv = document.getElementById('cache-results');
            
            // Test localStorage
            try {
                localStorage.setItem('test-android', Date.now());
                const retrieved = localStorage.getItem('test-android');
                localStorage.removeItem('test-android');
                
                // Test sessionStorage
                sessionStorage.setItem('test-session', 'ok');
                const session = sessionStorage.getItem('test-session');
                sessionStorage.removeItem('test-session');
                
                resultsDiv.innerHTML = `
                    <div class="test-result success">✅ localStorage: Fonctionnel</div>
                    <div class="test-result success">✅ sessionStorage: Fonctionnel</div>
                    <div class="test-result info">🔄 Cache navigateur: Probablement actif</div>
                    <div class="test-result info">💡 Solution: Utiliser cache: 'no-cache' dans fetch()</div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">❌ Problème storage: ${error.message}</div>
                `;
            }
        }
    </script>
</body>
</html>
